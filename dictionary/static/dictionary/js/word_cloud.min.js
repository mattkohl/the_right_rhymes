!function(t){function n(){function t(t,r,e){n[0],n[1];for(var a,o,u,i=r.x,f=r.y,l=Math.sqrt(n[0]*n[0]+n[1]*n[1]),x=w(n),s=Math.random()<.5?1:-1,h=-s;(a=x(h+=s))&&(o=~~a[0],u=~~a[1],!(Math.min(o,u)>l));)if(r.x=i+o,r.y=f+u,!(r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>n[0]||r.y+r.y1>n[1])&&(!e||!c(r,t,n[0]))&&(!e||y(r,e))){for(var d,v=r.sprite,g=r.width>>5,p=n[0]>>5,M=r.x-(g<<4),m=127&M,b=32-m,z=r.y1-r.y0,I=(r.y+r.y0)*p+(M>>5),k=0;k<z;k++){d=0;for(var q=0;q<=g;q++)t[I+q]|=d<<b|(q<g?(d=v[k*g+q])>>>m:0);I+=p}return delete r.sprite,!0}return!1}var n=[256,256],s=r,d=o,v=e,g=a,p=u,M=i,w=x,b=[],z=1/0,I=d3.dispatch("word","end"),k=null,q={};return q.start=function(){function r(){for(var r,i=+new Date;+new Date-i<z&&++u<o&&k;)(r=y[u]).x=n[0]*(Math.random()+.5)>>1,r.y=n[1]*(Math.random()+.5)>>1,f(r,y,u),t(e,r,a)&&(c.push(r),I.word(r),a?l(a,r):a=[{x:r.x+r.x0,y:r.y+r.y0},{x:r.x+r.x1,y:r.y+r.y1}],r.x-=n[0]>>1,r.y-=n[1]>>1);u>=o&&(q.stop(),I.end(c,a))}var e=h((n[0]>>5)*n[1]),a=null,o=b.length,u=-1,c=[],y=b.map(function(t,n){return{text:s.call(this,t,n),url:d.call(this,t,n),font:v.call(this,t,n),rotate:p.call(this,t,n),size:~~g.call(this,t,n),padding:i.call(this,t,n)}}).sort(function(t,n){return n.size-t.size});return k&&clearInterval(k),k=setInterval(r,0),r(),q},q.stop=function(){return k&&(clearInterval(k),k=null),q},q.timeInterval=function(t){return arguments.length?(z=null==t?1/0:t,q):z},q.words=function(t){return arguments.length?(b=t,q):b},q.size=function(t){return arguments.length?(n=[+t[0],+t[1]],q):n},q.font=function(t){return arguments.length?(v=d3.functor(t),q):v},q.rotate=function(t){return arguments.length?(p=d3.functor(t),q):p},q.text=function(t){return arguments.length?(s=d3.functor(t),q):s},q.spiral=function(t){return arguments.length?(w=m[t+""]||t,q):w},q.fontSize=function(t){return arguments.length?(g=d3.functor(t),q):g},q.padding=function(t){return arguments.length?(M=d3.functor(t),q):M},d3.rebind(q,I,"on")}function r(t){return t.text}function e(){return"serif"}function a(t){return Math.sqrt(t.value)}function o(t){return t.url}function u(){return 30*(~~(6*Math.random())-3)}function i(){return 1}function f(t,n,r){if(!t.sprite){M.clearRect(0,0,g<<5,p);var e=0,a=0,o=0,u=n.length;for(r--;++r<u;){t=n[r],M.save(),M.font=t.size+1+"px "+t.font;var i=M.measureText(t.text+"m").width,f=t.size<<1;if(t.rotate){var c=Math.sin(t.rotate*v),l=Math.cos(t.rotate*v),y=i*l,x=i*c,s=f*l,h=f*c;i=Math.max(Math.abs(y+h),Math.abs(y-h))+31>>5<<5,f=~~Math.max(Math.abs(x+s),Math.abs(x-s))}else i=i+31>>5<<5;if(f>o&&(o=f),e+i>=g<<5&&(e=0,a+=o,o=0),a+f>=p)break;M.translate(e+(i>>1),a+(f>>1)),t.rotate&&M.rotate(t.rotate*v),M.fillText(t.text,0,0),M.restore(),t.width=i,t.height=f,t.xoff=e,t.yoff=a,t.x1=i>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,e+=i}for(var d=M.getImageData(0,0,g<<5,p).data,m=[];--r>=0;){for(var w=(i=(t=n[r]).width)>>5,f=t.y1-t.y0,b=t.padding,z=0;z<f*w;z++)m[z]=0;if(null==(e=t.xoff))return;a=t.yoff;for(var I=0,k=-1,q=0;q<f;q++){for(z=0;z<i;z++){var D=w*q+(z>>5),S=(d[(a+q)*(g<<5)+(e+z)<<2]?1:0)<<31-z%32;b&&(q&&(m[D-w]|=S),q<i-1&&(m[D+w]|=S),S|=S<<1|S>>1),m[D]|=S,I|=S}I?k=q:(t.y0++,f--,q--,a++)}t.y1=t.y0+k,t.sprite=m.slice(0,(t.y1-t.y0)*w)}}}function c(t,n,r){r>>=5;for(var e,a=t.sprite,o=t.width>>5,u=t.x-(o<<4),i=127&u,f=32-i,c=t.y1-t.y0,l=(t.y+t.y0)*r+(u>>5),y=0;y<c;y++){e=0;for(var x=0;x<=o;x++)if((e<<f|(x<o?(e=a[y*o+x])>>>i:0))&n[l+x])return!0;l+=r}return!1}function l(t,n){var r=t[0],e=t[1];n.x+n.x0<r.x&&(r.x=n.x+n.x0),n.y+n.y0<r.y&&(r.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function y(t,n){return t.x+t.x1>n[0].x&&t.x+t.x0<n[1].x&&t.y+t.y1>n[0].y&&t.y+t.y0<n[1].y}function x(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function s(t){var n=4*t[0]/t[1],r=0,e=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:r+=n;break;case 1:e+=4;break;case 2:r-=n;break;default:e-=4}return[r,e]}}function h(t){for(var n=[],r=-1;++r<t;)n[r]=0;return n}var d,v=Math.PI/180,g=64,p=2048;"undefined"!=typeof document?((d=document.createElement("canvas")).width=g<<5,d.height=p):d=new(require("canvas"))(g<<5,p);var M=d.getContext("2d"),m={archimedean:x,rectangular:s};M.fillStyle="red",M.textAlign="center",t.cloud=n}("undefined"==typeof exports?d3.layout||(d3.layout={}):exports);