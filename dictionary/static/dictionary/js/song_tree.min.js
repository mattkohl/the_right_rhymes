var diameter=.9*window.innerWidth,tree=d3.layout.tree().size([360,diameter/2-120]).separation(function(e,t){return(e.parent==t.parent?1:2)/e.depth}),diagonal=d3.svg.diagonal.radial().projection(function(e){return[e.y,e.x/180*Math.PI]}),svgTree=d3.select("#songTreeVis").append("svg").attr("width",diameter).attr("height",diameter+50).append("g").attr("transform","translate("+diameter/2+","+diameter/2+")"),slug=d3.select(".song_slug").text(),endpoint="/data/songs/"+slug+"/release_date_tree/";$.getJSON(endpoint,{csrfmiddlewaretoken:"{{csrf_token}}"},function(e){var t=e,r=tree.nodes(t),a=tree.links(r),n=(svgTree.selectAll(".treeLink").data(a).enter().append("path").attr("class","treeLink").attr("d",diagonal),svgTree.selectAll(".treeNode").data(r).enter().append("g").attr("class",function(e){return e!=t?"treeNode":"treeRoot"}).attr("transform",function(e){return"rotate("+(e.x-90)+")translate("+e.y+")"}).on("click",function(e){e!=t&&(location.href=e.link)}));n.append("circle").attr("r",4.5),n.append("text").attr("dy",".31em").attr("text-anchor",function(e){return e.x<180?"start":"end"}).attr("transform",function(e){return e.x<180?"translate(8)":"rotate(180)translate(-8)"}).text(function(e){return e.name})}),d3.select(self.frameElement).style("height",diameter-150+"px");