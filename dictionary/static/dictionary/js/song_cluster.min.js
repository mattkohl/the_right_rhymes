var width=window.innerWidth,height=window.innerHeight,cluster=d3.layout.cluster().size([width,height]),diagonal=d3.svg.diagonal().projection(function(t){return[t.x,t.y/1.5]}),svg=d3.select("#songTreeVis").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate(0, 50)"),slug=d3.select(".song_slug").text(),endpoint="/data/songs/"+slug+"/release_date_tree/";$.getJSON(endpoint,{csrfmiddlewaretoken:"{{csrf_token}}"},function(t){var e=t,n=cluster.nodes(e),r=cluster.links(n),a=(svg.selectAll(".treeLink").data(r).enter().append("path").attr("class","treeLink").attr("d",diagonal),svg.selectAll(".treeNode").data(n).enter().append("g").attr("class",function(t){return t!=e?"treeNode":"treeRoot"}).attr("transform",function(t){return"translate("+t.x+","+t.y/1.5+")"}).on("click",function(t){t!=e&&(location.href=t.link)}));a.append("circle").attr("r",4.5),a.append("text").attr("dx",function(t){return t!=e?t.children?-8:8:4.75*t.name.length}).attr("dy",function(t){return t!=e?3:-10}).style("text-anchor",function(t){return t.children?"end":"start"}).text(function(t){return t.name}).attr("transform",function(t){return t!=e?"rotate(90)":"rotate(0)"})}),d3.select(self.frameElement).style("height",height-150+"px");